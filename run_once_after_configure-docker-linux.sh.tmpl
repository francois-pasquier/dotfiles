#!/bin/bash

{{ if eq .chezmoi.os "linux" -}}
# Only run if docker is installed
if command -v docker &>/dev/null; then
    echo "Configuring Docker group and user..."
    
    # Create docker group if it doesn't exist
    if ! getent group docker > /dev/null; then
        sudo groupadd docker
    fi

    # Enable and start Docker service if not already running
    if command -v systemctl &>/dev/null && ! systemctl is-active --quiet docker; then
        sudo systemctl enable --now docker
    fi

    # Add user to docker group if not already a member
    if ! groups $USER | grep &>/dev/null "\bdocker\b"; then
        sudo usermod -aG docker $USER
        echo "User added to the docker group."
        echo "Please log out and log back in for the changes to take effect."
    else
        echo "User is already in the docker group."
    fi
fi
{{ end -}}
